# Code Extractor - 智能项目代码提取工具

**Code Extractor** 是一个基于 Node.js 开发的命令行工具，旨在将复杂的项目目录结构和核心代码内容“扁平化”输出为一个单一的文本文件 (`.txt`)。

该工具主要用于**整理项目上下文**，方便开发者将整个项目的核心逻辑一次性投喂给 ChatGPT、Claude 等大语言模型 (LLM) 进行代码分析、重构或文档编写。

## ✨ 核心特性

*   **🧠 智能类型推断**：根据文件特征（如 `package.json` 依赖、特定配置文件）自动识别项目类型，并应用特定的扫描策略。
*   **🎮 强大的 CLI 控制**：
    *   **额外排除**：支持通过命令行动态添加忽略规则。
    *   **强制包含**：支持强制扫描被默认策略忽略的重要目录（如 Node 项目的 `bin` 目录）。
*   **🌳 目录树生成**：生成清晰的目录结构树。针对包含大量文件的文件夹（如 >100 个），自动进行折叠处理，避免输出冗余信息。
*   **📄 智能内容提取**：
    *   自动忽略 `.gitignore` 中的文件以及 `node_modules`, `dist` 等无意义目录。
    *   **大文件处理**：超过 100KB 的文件自动截断（保留首尾各 5KB）。
    *   **JSON 结构化裁剪**：针对超大 JSON/配置数据，保留其层级结构，但自动裁剪过长的数组（>3项）和对象属性，大幅节省 Token。
    *   **二进制过滤**：自动跳过图片、编译产物等二进制文件。
*   **🖼️ 媒体资源整理**：自动识别项目中的图片、音频和视频文件，统计尺寸与体积。
*   **交互式确认**：自动判断后提供用户确认环节，支持手动修正项目类型。

## 🚀 支持的项目类型

目前支持的自动识别类型如下：

| 项目类型 | 关键词/特征 | 状态 | 备注 |
| :--- | :--- | :--- | :--- |
| **Vue** | `vue`, `nuxt` | ✅ 已支持 | 自动忽略 `.nuxt`, `dist` |
| **React** | `react`, `next` | ✅ 已支持 | 自动忽略 `.next`, `build` |
| **Electron** | `electron` | ✅ 已支持 | 优先识别，支持包裹 Web 框架 |
| **Flutter** | `pubspec.yaml` | ✅ 已支持 | 自动忽略 `.dart_tool`, `android`, `ios` |
| **Node.js** | 后端框架 (`express`等) | ✅ 已支持 | 区分纯后端与通用 Web |
| **Generic Web** | `index.html`, 前端构建工具 | ✅ 已支持 | 兜底策略 |
| **Android/iOS** | 基础特征 | 🚧 待完善 | 目前使用通用策略 |

## 🛠 环境要求

*   **Node.js**: v14.0.0 或更高版本 (推荐 v16+)
*   **系统**: macOS / Linux / Windows

## 📦 安装

在项目根目录下执行安装依赖：

```bash
npm install
```

如果不希望每次都输入 `node bin/cli.js`，可以建立全局链接：

```bash
npm link
```
之后即可在任意位置直接使用 `code-extractor` 命令。

## 💻 使用方法

### 基本用法

**注意**：必须指定项目路径（支持相对路径或绝对路径）。

```bash
# 扫描当前目录下的 demo 项目
node bin/cli.js ./demo-project

# 或者使用绝对路径
node bin/cli.js /Users/username/workspace/my-app
```

### 进阶选项

#### 1. 添加额外排除规则 (`-e` / `--exclude`)
在默认策略和 `.gitignore` 的基础上，额外排除某些目录或文件。支持传入多个规则。

```bash
# 排除所有测试文件和 logs 目录
node bin/cli.js ./my-project -e "test" "*.spec.js" "logs"
```

#### 2. 强制包含/反向忽略 (`-i` / `--include`)
某些目录（如 `bin/`）在默认策略中可能被视为编译产物而被忽略。使用 `-i` 可以强制让扫描器包含这些目录。

```bash
# 正常扫描，但强制包含 bin 目录（即使默认策略忽略了它）
node bin/cli.js ./my-project -i "bin"
```

#### 3. 组合使用
```bash
# 扫描项目，排除 docs 文档，但强制包含 bin 脚本
node bin/cli.js ./my-project -e "docs" -i "bin"
```

### 命令行参数说明

| 选项 | 简写 | 说明 | 示例 |
| :--- | :--- | :--- | :--- |
| `--exclude` | `-e` | 额外排除的文件或目录模式 (空格分隔) | `-e *.log temp` |
| `--include` | `-i` | 强制包含的文件或目录模式 (优先级最高) | `-i bin scripts` |
| `--help` | `-h` | 显示帮助信息 | `-h` |

## 📂 输出结果

扫描完成后，结果将保存在当前目录的 `output/` 文件夹下，命名格式为：
`项目名-项目类型-上级目录名.txt`

**输出文件片段示例：**

```text
================================================================================
项目扫描报告
================================================================================
项目名称: my-app
项目类型: vue
强制包含: bin 
生成时间: 2025-11-30 20:45:00

================================================================================
目录结构树
================================================================================
/
├── bin/  <-- 因 -i bin 而被强制包含
│   └── cli.js
├── src/
│   ├── App.vue
│   └── main.js
...

================================================================================
文件内容详情
================================================================================

----------- [文件] bin/cli.js -----------
#!/usr/bin/env node
console.log('Hello World');
...
```

## 🏗 二次开发指南

本项目采用**策略模式 (Strategy Pattern)** 构建，易于扩展新的项目类型。

### 目录结构

```text
src/
├── core/
│   ├── Detector.js    # 负责判断项目类型
│   ├── Scanner.js     # 核心扫描逻辑 (处理 exclude/include)
│   ├── Processor.js   # 文件内容读取与裁剪
│   └── MediaCollector.js # 媒体资源统计
├── strategies/        # 策略模块 (定义默认忽略规则)
│   ├── BaseStrategy.js
│   └── ...
└── index.js           # 逻辑入口
bin/
└── cli.js             # 命令行入口 (参数解析)
```

### 如何修改默认忽略规则？

默认的忽略规则定义在 `src/strategies/BaseStrategy.js` 中。如果你希望某个目录（如 `bin`）对所有项目默认可见，可以直接修改该文件中的 `defaultIgnores` 数组。